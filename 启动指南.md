# 完整系统启动指南

## 启动顺序（共6个终端）

### 终端1：机器人基础启动
```bash
ros2 launch iqr_tb4_bringup bringup.launch.py
```

### 终端2：定位系统
```bash
 cd ros2_ws/src/iqr_tb4_ros/iqr_tb4_navigation/maps/
ros2 launch turtlebot4_navigation localization.launch.py map:=map.yaml

```

### 终端3：导航系统
```bash
ros2 launch turtlebot4_navigation nav2.launch.py
```

### 终端4：可视化（RViz）
```bash
ros2 launch turtlebot4_viz view_robot.launch.py
```

### 终端5：YOLO视觉检测节点
```bash
cd ~/ros2_ws
python3 src/yolov10_inference/yolov10_inference/yolo_rgs.py --ros-args -p confidence_threshold:=0.08
```

### 终端6：导航主节点（waypoint_publisher）
```bash
cd ~/ros2_ws
python3 src/waypoint_publisher.py
```

## 启动顺序说明

1. **先启动终端1-4**：基础系统（bringup、localization、nav2、rviz）
2. **等待基础系统完全启动后**，启动终端5（YOLO检测）
3. **最后启动终端6**（导航节点），开始执行任务

## 任务流程

1. **起始位置 → 点1**：导航过程中检测红灯/绿灯
   - 检测到红灯：暂停导航
   - 检测到绿灯：继续导航

2. **点1 → 点2**：正常导航

3. **点2 → 点3**：正常导航

4. **到达点3后**：执行抓取流程
   - 打开夹爪
   - 调整云台
   - 机械臂运动
   - ArUco识别
   - X/Y轴PID校准
   - 关闭夹爪抓取

5. **点3 → 点4**：导航过程中检测stop牌子
   - 检测到stop：暂停导航等待
   - 未检测到stop：继续导航

6. **到达点4后**：执行放置流程
   - 打开夹爪放置物品

7. **点4 → 点5**：正常导航（返回）

## 参数说明

- **YOLO置信度阈值**：`0.08`（如果检测效果不好，可以调整）
  - 降低阈值（如0.05）：更容易检测到，但可能误检
  - 提高阈值（如0.15）：更准确，但可能漏检

- **检测确认帧数**：`1`（在waypoint_publisher.py中设置）
  - 检测到1次就触发暂停（快速响应）

## 调试工具（可选）

如果需要观察检测效果，可以额外启动可视化节点：

```bash
python3 src/vision_detection_viewer.py
```

## 注意事项

1. 确保所有终端都在 `~/ros2_ws` 目录下运行
2. 确保地图文件路径正确：`/home/tony/ros2_ws/src/maps/map.yaml`
3. 如果YOLO检测不到目标，可以调整 `confidence_threshold` 参数
4. 如果导航暂停不工作，检查日志中的检测计数信息

